## NPM

#### Install npm

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * npm -v || npm --version
 * 
 * 
 */

获取 npm 版本信息


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * npm vs npx
 * 
 * 
 * npx 在执行一个需要安装的命令时，会先临时使用 npm 下载指定包
 */


//-------------------------------------------------------------------------------------------------------------------//


/**
 * 安装 npm
 * 
 * 
 */

由于 npm 的官方 registry 服务器位于国外，国内下载 package 可能会收到网速影响导致下载较慢

因此安装 npm 后，需配置国内镜像地址: https://reegistry.npm.taobao.org


cmd: npm config set registry https://reegistry.npm.taobao.org

npm config get registry                 // 设置后检查


//-------------------------------------------------------------------------------------------------------------------//


/**
 * 安装指定包
 * 
 * 
 * @packageName: 指定文件包名称
 */

npm install packageName 

npm i packageName


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * ./node_modules
 * 
 * 
 * npm 默认包管理文件: 一般在 当前工程的根目录下
 */

随着开发的进展，node_module 目录文件会异常庞大，因此需要 .gitignore 设置忽略该文件目录

使用 npm 中的包时，npm 会自动管理依赖，自调下载该包所需的依赖包

如果本地安装包带有 CLI，npm 会将它的 CLI 脚本配置文件放置到 node_modules/.bin 文件下运行，使用 npx 调用即可

( 计算机环境变量，某些命令仅可以在指定文件下才可以运行，npx 类似暴露于全局的 npm )


//-------------------------------------------------------------------------------------------------------------------//


/**
 * 全局安装                     // 全局安装并非解决多工程公用包，而是为了提供全局的 CLI 工具
 * 
 * 
 * 安装全局包，可以在全局环境中使用相关命令行命令
 */

npm install --global packageName

npm config get prefix                           // 查看全局安装的配置目录


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


大部分情况下，都不需要全局安装包，除非:

1) 包的版本非常稳定，很少有大的更新

2) 命令行在各个工程中使用的非常频繁

3) CLI 工具仅在开发环境中提供支持，而非部属环境


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### npm config

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 创建 npm 配置文件
 * 
 * 
 * package.json             // 可以手动创建，大多时候使用命令创建
 */

npm init                    // 根据提示创建 npm 配置文件信息


npm init --yes              // 生成默认配置文件

npm init -y


//-------------------------------------------------------------------------------------------------------------------//


/**
 * package name:
 * 
 * 
 */

package 的名称，该名称必须是英文单词字符( 支持连字符 )


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -/

/**
 * version(1.0.0):                  // 默认 (1.0.0)
 * 
 * 
 * 版本范围: 主版本号.次版本号.补丁版本号
 */

主版本号: 仅当程序发生了重大改变时，才会增长，如新增重要功能，新增了大量 API，技术架构发生了重大改变

次版本号: 仅当程序发生了一些小变化时才会增长，如新增了一些小功能，新增了一些辅助型 API

补丁版本号: 仅当解决了一些 bug 或 进行了一些局部优化时更新，如修复了某个函数的 bug，提升了某个函数的运行效率


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * description:
 * 
 * 
 */

packeage 的描述信息


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * homepage:
 * 
 * 
 */

package 的官网地址


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * git repository:
 * 
 * 
 */

package 的仓储地址( 通常指 git 或 svn 的地址 )，repository 的类型是 对象

{

    type: 仓储类型( git / svn )

    url: 地址
}


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * entry point:                     // main
 * 
 * 
 */

package 的入口文件，调用该 package 的开发者默认从该文件导入 package 的内容


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * test command:
 * 
 * 
 */

package 测试命令


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * keywords:
 * 
 * 
 */

设置搜索该 package 时的关键字


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * author:
 * 
 * 
 */

package 的作者，必须是有效的 npm 账户名，书写规范是 accoount<mail> eg: alpha<xiaodao_92@gmail.com>

( 错误的作者信息可能会导致发布时失效 )



//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * license:                     // 默认 ISC 
 * 
 * 
 */

package 发布协议


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### Engineering dependency of npm-config

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * package.json 最重要的作用
 * 
 * 
 * 记录当前工程的依赖
 */

dependencies: 生产环境的依赖包

devDependencies: 仅开发环境的依赖包


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


npm install                         // 安装所有依赖 dependencies + devDependencies

npm i


npm install --production            // 仅安装生产环境的依赖 dependencies


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


{
    "name": "6.1-Engineering",
    "version": "1.0.0",
    "description": "",
    "main": "index.js",
    "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
    },
    "keywords": [],
    "author": "",
    "license": "ISC",
    
    dependencies :{
        
        "xxx": "xxx"
    },
    
    devDependencies: {
        
        "xxx": "xxx"
    }
}


//-------------------------------------------------------------------------------------------------------------------//


/**
 * 为方便开发，npm 在 install 时，可加入额外参数，指定 package 的依赖配置信息
 * 
 * 
 */


npm i packageName                               // 安装到生产环境

npm i --save

npm i -S packageName


npm i --sava-dev packageName                    // 安装到依赖环境

npm i -D packageName


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### How to require indexFile

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 如何引入 package 的 indexFile
 * 
 * 
 * 特殊情况: 若 require('packageName'); 引入的是 node 的内置模块，则会直接返回 node 中的内置模块
 */

当使用 node.js 导入模块时，如果模块的路径不是以 './ 或 ../' 开头

则 node 会认为导入的模块来自于 node_modules 目录              // require('packageName');


eg: 

let _ = require("lodash");           // 在还未有模块化开发时，npm 暴露给全局的变量为 _

=> 优先查找 node_modules/lodash.js

           node_modules/lodash/indexFile( 入口文件 )

=> 若在指定路径中未找到 入口文件，则会回溯到 上级目录寻找，直到回溯到 根目录，若还未找到，则抛出错误


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * 如何获取 入口文件                    // 此规则同样适用于 自创的 package
 * 
 * 
 */

1) 查看指定 package 中的 package.json 文件，读取 main 字段的值 作为 '入口文件'

2) 若 package.json 不包含 main 字段，则使用 index.js 作为 '默认入口文件'


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * 导入 package 中的指定文件
 * 
 * 
 */

eg: let test = require("lodash/fp/add");


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### Semantic version

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 语义版本
 * 
 * 
 */

若编写了一个包A，依赖另一个包B

在编写时，包 B 的版本是 2.4.1

当他人使用你的包时，你希望别人安装包 B 的什么版本，你编写包 B 时的版本，更高的版本？


//-------------------------------------------------------------------------------------------------------------------//


版本范围: 主版本号.次版本号.补丁版本号


主版本号: 仅当程序发生了重大改变时，才会增长，如新增重要功能，新增了大量 API，技术架构发生了重大改变

次版本号: 仅当程序发生了一些小变化时才会增长，如新增了一些小功能，新增了一些辅助型 API

补丁版本号: 仅当解决了一些 bug 或 进行了一些局部优化时更新，如修复了某个函数的 bug，提升了某个函数的运行效率


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


可以根据版本号去选择升级(  )

安装依赖包时: 次版本号 和 补丁版本号 可提升，主版本号 不能提升

安装依赖包时: 仅 补丁版本号 可提升


//-------------------------------------------------------------------------------------------------------------------//


// 部分语义版本规则


符号      描述               示例                  示例描述

 >       大于某个版本         >1.2.1               大于 1.2.1 版本

 >=      大于等于某个版本      >1.2.1               大于等于 1.2.1 版本
  
 <       小于某个版本         <1.2.1               小于 1.2.1 版本

 <=      小于等于某个版本      <1.2.1               小于等于 1.2.1 版本

 -       介于两个版本之间      1.2.1-1.4.5          介于 1.2.1 - 1.4.5 之间 

 x       不固定版本号          1.3.x               只保证主版本号为 1，次版本号为 3 即可
 
 ~      补丁版本号可增        ~1.3.4               主版本号为 1，次版本号为 3，补丁版本号大于等于 4
 
 ^       此版本和补丁版可增    ^1.3.4               主版本号为 1，次版本号大于等于 3，补丁版本号大于等于 4
 
 *       最新版本             *1.3.4               始终安装最新版本嗯


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * package-lock.json
 * 
 * 
 * 最开始由 yarn 提出
 */


若允许依赖的包版本增加，可以让依赖包的部分bug得以修复，但同时也可以产生一些新的bug

在多层依赖包时，所产生的问题是不可控的

基于此类问题，npm 在安装包的时，自动生成了 package-lock.json 文件，该文件记录了安装包时的额确切依赖关系

当移植工程时，若移植了 package-lock.json 文件，则会按照 该文件中的确切依赖关系进行安装( 最大程度的避免了工程移植的差异性 )


//-------------------------------------------------------------------------------------------------------------------//


/**
 * 若两个包依赖于同一个包的不同版本
 * 
 * 
 */

        A ------> C             // 1.4.0
        B ------> C             // 1.2.3


此时 npm 不会使用 扁平目录结构，而会形成嵌套目录结构

|--- node_modules
|
|   |--- a
|   |
|   |   |--- node_modules
|   |   |
|   |   |   |--- c
|   |   |   |
|   |   |   |   |--- c-package-file         // 1.4.0
|   |   |   |   |
|   |   |
|   |   |--- a-package-file
|   |
|   |--- b
|   |
|   |   |--- node_modules
|   |   |
|   |   |   |--- c
|   |   |   |
|   |   |   |   |--- c-package-file         // 1.2.3
|   |   |   |   |
|   |   |
|   |   |--- b-package-file


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### NPM Script

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * npm 可以在 package.json 中配置的便捷脚本命令
 * 
 * 
 * 原理: 将当前 script-command 放在 指定环境变量的 目录中执行，解决了无环境变量的问题( 从全局到指定文件 )
 */


"scripts: {

    "script-name" : "script-command",
   
    "start": "npx nodemon index.js"         // eg

    ...
} 

invoking: npm run + script-name

          npm run start


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### Code running environment

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


1) 开发环境                 // development environment

2) 生产环境                 // production environment

3) 测试环境                 // test environment


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


let env;

if(process.env.NODE_ENV === 'development') {                    // 判断是否是开发环境

    env = 'development environment';
    
} else if (process.env.NODE_ENV === 'production') {             // 判断是否是生产环境
          
    env = 'production environment';
  
} else if (process.env.NODE_ENV === 'test') {                   // 判断是否是测试环境
          
    env = 'test environment';
    
} else {

    throw new Exc;
}


//-------------------------------------------------------------------------------------------------------------------//


/**
 * global                   // node 环境中全局变量，类似于浏览器环境的 window
 * 
 * 
 * 缺点: 不利于修改，使用较麻烦
 */


global

global.process

global.process.env          // 获取所有全局环境变量


NODE_ENV = ( development | production | test )


.bash_profile                       // 在系统指定环境变量文件中设置固定环境变量

export NODE_ENV="development"



//-------------------------------------------------------------------------------------------------------------------//


/**
 * 临时全局变量
 * 
 * 
 * 不同操作系统中需要使用 不同的 shell 命令创建全局临时变量
 */


// windows

"scripts": {

    "start": "set NODE_ENV=development&&node index.js",
    "build": "set NODE_ENV=production&&node index.js",
    "test": "set NODE_ENV=test node&&index.js"
},


// macOS

"scripts": {

    "start": "export NODE_ENV=development&&node index.js",
    "build": "export NODE_ENV=production&&node index.js",
    "test": "export NODE_ENV=test&&node index.js"
}


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * cross-env                        // 利用第三方库，
 * 
 * 
 * 解决在不同操作系统中获取系统临时环境变量的兼容问题
 */


"scripts": {

    "start": "cross-env NODE_ENV=development node index.js",
    "build": "cross-env NODE_ENV=production node index.js",
    "test": "cross-env NODE_ENV=test node index.js"
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### Custom-Attribute of package.json

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


有时候，我们可能在 package.json 中配置一些自定义字段，这些字段需要在 node 中读取

在 node 中，可以直接导入一个 json 格式的文件，会自动转换为 js 对象


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


{
  "name": "case-6-npm-environment",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",

  "scripts": {

    "start": "cross-env NODE_ENV=development node index.js",
    "build": "cross-env NODE_ENV=production node index.js",
    "test": "cross-env NODE_ENV=test node index.js"
  },

  "author": "",
  "license": "ISC",

  "alpha": "996"                // 自定义属性，仅用于 node 调用
}



const config = require("./package.json");

console.log(config.alpha);


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

## Command Line OF NPM

#### install

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 精确安装最新版本
 * 
 * 
 */

npm install --save-exact packageName

npm install -E packageName


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * 安装指定版本
 * 
 * 
 */

npm install packageName@versionNumber


//-------------------------------------------------------------------------------------------------------------------//


npm install             moduleName                  // 不记录依赖关系( npx: 全局使用 )

1. 安装模块到项目 node_modules 目录下
2. 不会将模块依赖写入 devDependencies 或 dependencies 节点
3. 运行 npm install 初始化项目时不会下载模块


npm install -g          moduleName                  // 全局环境使用

1. 安装模块到全局，不会在项目 node_modules 目录中保存模块包
2. 不会将模块依赖写入 devDependencies 或 dependencies 节点
3. 运行 npm install 初始化项目时不会下载模块


npm install -save       moduleName                  // 生产环境使用
npm install -S          moduleName                  // 生产环境使用

1. 安装模块到项目 node_modules 目录下
2. 会将模块依赖写入dependencies 节点
3. 运行 npm install 初始化项目时，会将模块下载到项目目录下
4. 运行 npm install --production 或者注明 NODE_ENV 变量值为 production 时，会自动下载模块到 node_modules 目录中


npm install -save-dev   moduleName                  // 开发环境使用
npm install -D          moduleName

1. 安装模块到项目 node_modules 目录下
2. 会将模块依赖写入 devDependencies 节点
3. 运行 npm install 初始化项目时，会将模块下载到项目目录下
4. 运行npm install --production 或者注明 NODE_ENV 变量值为 production 时，不会自动下载模块到 node_modules 目录中


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### search

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 查询安装最新版本
 * 
 * 
 */

npm root [-g]                       // 返回全局安装路径

npm root                            // 返回当前安装路径


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * 查询包信息
 * 
 * 
 */

npm view packageName [subInfo]

npm v packageName [subInfo]

npm show packageName [subInfo]

## view aliase: v info show


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * 查询安装包
 * 
 * 
 * 返回当前安装的包的列表
 */

npm list [-g] [--deph=Dependency: number]

npm ls [-g] [--deph=Dependency: number]

npm la [-g] [--deph=Dependency: number]

npm ll [-g] [--deph=Dependency: number]

## list aliases: ls la ll


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### update

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 检查哪些包需要更新
 * 
 * 
 */

npm outdated


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * 更新指定包
 * 
 * 
 */

npm update [-g] [packageName]

## updata aliases: up upgrade


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * 利用局部 npm，安装全局 npm
 * 
 * 
 */

npm i -g npm


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### uninstall


``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 卸载包
 * 
 * 
 */

npm uninstall [packageName]

## uninstall aliases: remove rm r un unlink


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### npm config

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 安装 npm 后，会产生 两个配置文件
 * 
 * 
 * 用户配置 & 系统配置          // 当两个文件有冲突时，用户配置会覆盖系统配置
 */

npm config ls [-l] [--json]


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * 获取某个配置项
 * 
 * 
 */
 
npm config get item


/**
 * 设置某个配置项
 * 
 * 
 */

npm config set item


/**
 * 移除某个配置项
 * 
 * 
 */

npm config delete item


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

## Release package

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 准备工作
 * 
 * 
 */


1) 移除 npm 淘宝资源镜像地址

2) npm 官网注册账号，并完成邮箱验证

3) 本地使用 npm cli 登陆

    - 使用 cmd:  npm login 登陆

    - 使用 cmd:  npm whoami 查看当前登陆账号

    - 使用 cmd:  npm logout 注销

4) 创建工程根目录

5) 使用 npm init 初始化


/**
 * 发布
 * 
 * 
 */

1) 开发

2) 确定版本

3) 使用 cmd: npm publish 发布


//-------------------------------------------------------------------------------------------------------------------//


/**
 * 可通过以下网站选择协议
 * 
 * 
 * http://choosealicense.online/appendix/
 */


修改源码后是否可以开源 {

    yes {
    
        是否需要版权说明 {
        
            yes { 
            
                Apache 许可
            },
            
            no {
            
                商用后能否用作者名字宣传 {
                
                    yes {
                    
                        MIT 许可
                    },
                    
                    no  {
                    
                        ISC 许可,
                        
                        BSD 许可
                    }
                }
            }
        }
    },
    
    no {
    
        新增代码是否采用同样的许可 {
        
            yes {
            
                GPL 许可
            },
            
            no {
            
                是否需要对修改处提供说明文档 {
                
                    yes {
                    
                        Mozilla 许可
                    },
                    
                    no {
                    
                        LGPL 许可
                    }
                }
            }
        }
    }
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```
