## JS Compatibility

#### babel

[官网](https://babel.jsio)

[中文](https://www,babeljs.cn/)

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * babel                // 源于希腊，直译为 '巴别塔'
 * 
 * 
 * babel 可以和构建工具联合使用，也可以单独使用
 * 
 * 若需要独立使用 babel，则需要安装
 * 
 *      @babel/core: babel 核心库，提供编译所需的所有 api
 *      @babel/cli: 提供命令行工具，调用核心库的 api 完成编译
 */


npm install --save-dev @babel/core @babel/cli


              + ----------------------- PostCss -------------------------- +
              |                                                            |
    JS-source -> | Parser -> [ plugin1, plugin2, plugin3 ... ] -> Stringofier | -> JS-Compatibility-code
              |                                                            |
              + ---------------------------------------------------------- +


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


npm install -D babel-loader @babel/core @babel/preset-env webpack

npm install -D core-js regenerator-runtime      // babel 依赖的语法和API的补充库


babel souorce.babel -o ouput.js                 // 编译指定文件

babel ./js -o ./ouput                           // 编译指定目录中的所有文件


//-------------------------------------------------------------------------------------------------------------------//



/**
 * babel-loader
 * 
 * 
 * 
 */

npm install --save-dev babel-loader @babel/core


//-------------------------------------------------------------------------------------------------------------------//


/**
 * babel 的配置
 * 
 * 
 * babel 的编译需要依托于 babel-plugins & babel-preset 完成
 */

需创建 .babelrc ( json ) 

{
    "presets": [],
    "plugins": []
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

## babel-preset

#### @babel/preset-env

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * @babel/preset-env
 * 
 * 
 * @babel/preset-env 会自动转换JS语法的兼容代码
 * 
 * 常规状态下 @babel/preset-env 仅转换已形成标准的正式语法，对于部分处于早期阶段或还未确定的语法不做转换( 则需要使用一些插件解决 )
 */

npm install --save-dev @babel/preset-env


{
  "presets": [
    "@babel/preset-env"
  ],
  "plugins": []
}


//-------------------------------------------------------------------------------------------------------------------//


/**
 * 设置兼容浏览器范围
 * 
 * 
 */

创建 .browserslistrc 并配置

last 1 version
> 10%
not ie <= 8


//-------------------------------------------------------------------------------------------------------------------//


/**
 * 解决部分新语法不兼容
 * 
 * 
 * 在编译后的文件中查看 requiu("target.module")，并下载该模块即可
 */

// @babel/preset-env 依赖                 // @babel/polyfill( 已过时 )
// 
// core-js 模块( 需要下载该模块 )            // 主要针对现有的新的 API
// regenerator-runtime                    // 主要针对新的语法，将新语法转换为 API
// 
// 不同的新语法可能会依赖不同的库( 检查编译后的文件 requiu("target.module")，并下载该模块即可 )

{
  "presets": [
    [
      "@babel/preset-env",
      {
        "useBuiltIns": "usage"              // 默认 false，设置 usage 后
                                            // require("core-js/modules/es6.promise");
                                            // require("core-js/modules/es6.object.to-string");
                                            // ...
      }
    ]
  ],
  
  "plugins": []
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### babel-plugins

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * babel-plugins
 * 
 * 
 * 
 */

babel 是一个编译器( 源码 => 输出编译后的代码 )

若需使用一些前沿的语法规范，就需要借助插件支持


//-------------------------------------------------------------------------------------------------------------------//


/**
 * babel 中 preset & plugin 的执行顺序
 * 
 * 
 * 
 */

1) 插件在 Presets 前运行

2) 插件运行顺序: 从前到后

3) Presets运行顺序: 从后到前


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### @babel/plugin-proposal-class-properties

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * @babel/plugin-proposal-class-properties
 * 
 * 
 * 该插件可以使你在 类中书写初始化字段
 */

npm install --save-dev @babel/plugin-proposal-class-properties


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


class A {

    a = 1;

    constructor() {

        this.b = 3;
    }
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### @babel/plugin-proposal-function-bind

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * @babel/plugin-proposal-function-bind
 * 
 * 
 * 该插件用于为某个方法绑定 this
 */

npm install --save-dev @babel/plugin-proposal-function-bind


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


function Print() {

    console.log(this.loginId);
}

const obj = {
    loginId: "abc"
};

obj::Print();


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### @babel/plugin-proposal-optional-chaining

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * @babel/plugin-proposal-optional-chaining
 * 
 * 
 * ?.  // 是否有，有则继续判断，没有则返回 undefined, 
 */

npm install --save-dev @babel/plugin-proposal-optional-chaining


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


const obj1 = {

    foo: {

        bar: {

            bax: 42,
        }
    }
};


// if (obj1 && obj1.foo && obj1.foo.bar && obj1.foo.bar.bax === 42) {}

const bax = obj?.foo?.bar?.bax;         // 42

const safe = obj?.qux?.bax;             // undefined


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### babel-plugin-transform-remove-console

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * babel-plugin-transform-remove-console
 * 
 * 
 * 移除源码中控制台输出语句
 */

npm install babel-plugin-transform-remove-console --save-dev


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### @babel/plugin-transform-runtime

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * @babel/plugin-transform-runtime
 * 
 * 
 * 为了将部分 高级语法兼容所产生的代码冗余，此插件会将各个模块中冗余的代码 提取出来作为公共模块
 */

npm install --save-dev @babel/plugin-transform-runtime


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```




